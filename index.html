<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Team Notepad</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .tab-container {
        display: flex;
        margin-bottom: 10px;
        gap: 5px;
      }
      .tab {
        padding: 10px 15px;
        cursor: pointer;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 5px 5px 0 0;
        transition: background-color 0.2s;
      }
      .tab.active {
        background-color: white;
        border-bottom: 1px solid white;
      }
      .tab:hover {
        background-color: #e0e0e0;
      }
      textarea {
        width: 100%;
        height: 300px;
        font-size: 16px;
        padding: 10px;
        border: 1px solid #ccc;
        margin-top: -1px;
      }
      .modal {
        display: block;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }
      .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 300px;
        border-radius: 5px;
        text-align: center;
      }
      .modal-content input[type="password"] {
        width: 90%;
        padding: 10px;
        margin: 10px 0;
        font-size: 16px;
      }
      .modal-content button {
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
      }
      #mainContent {
        display: none;
      }
      #errorMessage {
        color: red;
        display: none;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div id="passwordModal" class="modal">
      <div class="modal-content">
        <h2>Enter Password</h2>
        <input type="password" id="passwordInput" placeholder="Password" />
        <br />
        <button id="submitPassword">Submit</button>
        <p id="errorMessage">Incorrect password. Please try again.</p>
      </div>
    </div>

    <div id="mainContent">
      <h1>Team Notepad</h1>
      <div class="tab-container">
        <div class="tab active" data-user="Nitin">Nitin</div>
        <div class="tab" data-user="Meghna">Meghna</div>
        <div class="tab" data-user="Robin">Robin</div>
        <div class="tab" data-user="Imti">Imti</div>
        <div class="tab" data-user="Karan">Karan</div>
        <div class="tab" data-user="Rashmi">Rashmi</div>
      </div>
      <p>Type anything below. Changes will instantly sync across all browsers!</p>
      <textarea id="notepad" placeholder="Start typing..."></textarea>

      <script>
        // Password Protection
        document.getElementById('submitPassword').addEventListener('click', function() {
          const enteredPassword = document.getElementById('passwordInput').value;
          const correctPassword = 'ni3';
          if (enteredPassword === correctPassword) {
            document.getElementById('passwordModal').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
          } else {
            document.getElementById('errorMessage').style.display = 'block';
          }
        });

        document.getElementById('passwordInput').addEventListener('keyup', function(event) {
          if (event.key === 'Enter') {
            document.getElementById('submitPassword').click();
          }
        });

        // Firebase Configuration
        const firebaseConfig = {
          apiKey: "AIzaSyCWfmVe1bh8OXgw0PjnAbfVD6ZOnRJ4-6o",
          authDomain: "clipboard-e729a.firebaseapp.com",
          projectId: "clipboard-e729a",
          storageBucket: "clipboard-e729a.firebasestorage.app",
          messagingSenderId: "212944151207",
          appId: "1:212944151207:web:fd2dbdec1c76ce2bf13182",
          measurementId: "G-L6CTJD19HW"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let currentNoteRef = null;
        let unsubscribe = null;
        let currentUser = 'Nitin';

        // Tab Functionality
        document.querySelectorAll('.tab').forEach(tab => {
          tab.addEventListener('click', function() {
            if (this.classList.contains('active')) return;
            
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            currentUser = this.dataset.user;
            switchUserNotepad(currentUser);
          });
        });

        function switchUserNotepad(userId) {
          // Clear previous listener
          if (unsubscribe) unsubscribe();
          
          // Set up new document reference
          currentNoteRef = db.collection("userNotes").doc(userId);
          
          // Disable textarea during load
          const textArea = document.getElementById("notepad");
          textArea.disabled = true;

          // Get initial data and set up listener
          unsubscribe = currentNoteRef.onSnapshot(doc => {
            if (doc.exists) {
              textArea.value = doc.data().content || '';
            } else {
              textArea.value = '';
            }
            textArea.disabled = false;
          }, error => {
            console.error("Error getting document:", error);
            textArea.disabled = false;
          });
        }

        // Text Input Handling
        const textArea = document.getElementById("notepad");
        let typingTimer;
        
        textArea.addEventListener("input", function() {
          clearTimeout(typingTimer);
          typingTimer = setTimeout(() => {
            if (currentNoteRef) {
              currentNoteRef.set({ 
                content: textArea.value,
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                user: currentUser
              }).catch(error => console.error("Error writing document: ", error));
            }
          }, 300);
        });

        // Initialize first tab
        switchUserNotepad('Nitin');
      </script>
    </div>
  </body>
</html>
